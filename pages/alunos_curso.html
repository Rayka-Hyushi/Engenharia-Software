<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>SCI - Cursos</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" />
        <link rel="stylesheet" href="../css/style.css">
    </head>
    <body>
        <header class="menu">
            <nav class="navbar navbar-expand-sm custom-navbar d-flex align-items-center">
                <div class="d-flex align-items-center">
                    <a class="navbar-brand" href="home.html">
                        <img src="../images/logo.png" class="logo-img img-fluid" alt="Logo">
                    </a>
                    <div class="ml-3">
                        <span class="navbar-text bem-vindo d-block">Bem-Vindo ao Sistema de Coordenação
                            Institucional!</span>
                        <ul class="navbar-nav flex-row">
                            <li class="nav-item mx-2">
                                <a class="nav-link" href="./home.html">Início</a>
                            </li>
                            <li class="nav-item mx-2">
                                <a class="nav-link" href="./cursos.html">Cursos</a>
                            </li>
                            <li class="nav-item mx-2">
                                <a class="nav-link active" href="./alunos.html">Alunos</a>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Parte do usuário à direita -->
                <div class="ml-auto d-flex align-items-center user-area">
                    <img src="../images/perfil.jpg" alt="Usuário" class="rounded-circle user-img">
                    <div class="ml-2 text-right">
                        <span class="d-block user-name">Vinicius</span>
                        <a href="../index.html" class="small text-primary">Sair</a>
                    </div>
                </div>
            </nav>
        </header>
        <main class="principal">
            <div class="container mt-4">
                <div class="input-group mb-3">
                    <input type="text" class="form-control"
                        placeholder="Digite o nome ou código do curso aqui para pesquisar">
                    <div class="input-group-append">
                        <button class="btn pesquisa" type="button"><img src="../images/pesquisa-lupa.png"
                                alt="lupa de pesquisa"></button>
                    </div>
                </div>

                <div class="d-flex justify-content-end mb-2">
                    <div class="dropdown">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownFiltro" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Filtro <span id="texto-filtro">Evasão ↓</span>
                        </button>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownFiltro">
                            <h6 class="dropdown-header">Ordenar por:</h6>
                            <button class="dropdown-item" onclick="setFiltro('nome', true)">Nome ↑</button>
                            <button class="dropdown-item" onclick="setFiltro('nome', false)">Nome ↓</button>
                            <button class="dropdown-item" onclick="setFiltro('matricula', true)">Matrícula ↑</button>
                            <button class="dropdown-item" onclick="setFiltro('matricula', false)">Matrícula ↓</button>
                            <button class="dropdown-item" onclick="setFiltro('evasao', true)">Evasão ↑</button>
                            <button class="dropdown-item" onclick="setFiltro('evasao', false)">Evasão ↓</button>
                        </div>
                    </div>
                </div>

                <table class="table table-bordered table-hover bg-white">
                    <thead class="thead-light">
                        <tr>
                            <th>Nome</th>
                            <th>Matrícula</th>
                            <th>Probabilidade de Evasão</th>
                        </tr>
                    </thead>
                    <tbody id="tabela-cursos">
                        <!-- As linhas da tabela serão preenchidas dinamicamente -->
                    </tbody>
                </table>
            </div>
        </main>
        <script>
            const alunos = [
                { nome: "Luigi Carvalho", curso: "Enfermagem", matricula: 201376672, probabilidade_evasao: 1.0 },
                { nome: "Joana Mendes", curso: "Engenharia Civil", matricula: 206533397, probabilidade_evasao: 0.878 },
                { nome: "Joaquim Freitas", curso: "Física", matricula: 202710378, probabilidade_evasao: 0.079 },
                { nome: "Alexandre Viana", curso: "Direito", matricula: 203631208, probabilidade_evasao: 0.893 },
                { nome: "Joana Fernandes", curso: "Física", matricula: 209477602, probabilidade_evasao: 0.433 },
                { nome: "Maria Alice Rodrigues", curso: "Enfermagem", matricula: 202507501, probabilidade_evasao: 0.175 },
                { nome: "Davi Lucca da Cunha", curso: "Arquitetura", matricula: 206136926, probabilidade_evasao: 0.891 },
                { nome: "Maria Clara Pereira", curso: "Economia", matricula: 202598654, probabilidade_evasao: 0.476 },
                { nome: "Sra. Isabella Moraes", curso: "Física", matricula: 209802201, probabilidade_evasao: 0.359 },
                { nome: "Igor Teixeira", curso: "Educação Física", matricula: 202326002, probabilidade_evasao: 0.223 },
                { nome: "Bruna Gomes", curso: "Sociologia", matricula: 201064051, probabilidade_evasao: 0.149 },
                { nome: "Srta. Beatriz Nogueira", curso: "Direito", matricula: 201896243, probabilidade_evasao: 0.972 },
                { nome: "Diogo Barros", curso: "Biologia", matricula: 207853699, probabilidade_evasao: 0.054 },
                { nome: "Maria Fernanda Fernandes", curso: "Contabilidade", matricula: 203677752, probabilidade_evasao: 0.838 },
                { nome: "Eloah Barbosa", curso: "Matemática", matricula: 204848629, probabilidade_evasao: 0.976 },
                { nome: "Vitor da Mata", curso: "Geografia", matricula: 209049996, probabilidade_evasao: 0.649 },
                { nome: "Sarah Dias", curso: "História", matricula: 209311812, probabilidade_evasao: 0.001 },
                { nome: "Caroline Teixeira", curso: "Enfermagem", matricula: 203391983, probabilidade_evasao: 0.626 },
                { nome: "Bruno Araújo", curso: "Matemática", matricula: 208964621, probabilidade_evasao: 0.388 },
                { nome: "Igor Teixeira", curso: "Educação Física", matricula: 208124002, probabilidade_evasao: 0.773 },
                { nome: "Lavínia Farias", curso: "Letras", matricula: 203306853, probabilidade_evasao: 0.013 },
                { nome: "João Miguel Cardoso", curso: "Direito", matricula: 207740913, probabilidade_evasao: 0.238 },
                { nome: "Elisa Peixoto", curso: "Engenharia Civil", matricula: 204289207, probabilidade_evasao: 0.662 },
                { nome: "Emanuella Moreira", curso: "Letras", matricula: 202049425, probabilidade_evasao: 0.78 },
                { nome: "Srta. Isis Vieira", curso: "Medicina", matricula: 201505917, probabilidade_evasao: 0.225 },
                { nome: "Luiza Barbosa", curso: "Contabilidade", matricula: 204912968, probabilidade_evasao: 0.947 },
                { nome: "Ana Carolina Pires", curso: "Design", matricula: 206532076, probabilidade_evasao: 0.174 },
                { nome: "Dr. Danilo Mendes", curso: "Arquitetura", matricula: 205508143, probabilidade_evasao: 0.462 },
                { nome: "Joaquim Cavalcanti", curso: "Ciência da Computação", matricula: 207670695, probabilidade_evasao: 0.78 },
                { nome: "Sr. Thales Jesus", curso: "Administração", matricula: 203551876, probabilidade_evasao: 0.315 },
                { nome: "Sabrina da Mata", curso: "Medicina", matricula: 202572748, probabilidade_evasao: 0.478 },
                { nome: "Luiz Otávio Caldeira", curso: "Design", matricula: 203688683, probabilidade_evasao: 0.457 },
                { nome: "Raul Aragão", curso: "Direito", matricula: 200779117, probabilidade_evasao: 0.104 },
                { nome: "Kamilly Teixeira", curso: "Química", matricula: 205778312, probabilidade_evasao: 0.739 },
                { nome: "Emanuelly da Conceição", curso: "Economia", matricula: 200573331, probabilidade_evasao: 0.52 },
                { nome: "Breno Novaes", curso: "Sociologia", matricula: 205116850, probabilidade_evasao: 0.45 },
                { nome: "Luiz Henrique da Paz", curso: "Educação Física", matricula: 207197687, probabilidade_evasao: 0.886 },
                { nome: "Bruna Rezende", curso: "Jornalismo", matricula: 207265918, probabilidade_evasao: 0.136 },
                { nome: "Bryan Ramos", curso: "Direito", matricula: 201294898, probabilidade_evasao: 0.858 },
                { nome: "Vitor Gabriel Rocha", curso: "História", matricula: 201141753, probabilidade_evasao: 0.405 },
                { nome: "Carolina Mendes", curso: "Contabilidade", matricula: 205233466, probabilidade_evasao: 0.922 },
                { nome: "Ana Carolina Costela", curso: "Biologia", matricula: 209203529, probabilidade_evasao: 0.635 },
                { nome: "Isabel Azevedo", curso: "Engenharia Elétrica", matricula: 206503225, probabilidade_evasao: 0.062 },
                { nome: "Samuel Alves", curso: "Enfermagem", matricula: 209404610, probabilidade_evasao: 0.455 },
                { nome: "Emilly Rocha", curso: "Contabilidade", matricula: 200686735, probabilidade_evasao: 0.781 },
                { nome: "Renan Freitas", curso: "Sociologia", matricula: 207494754, probabilidade_evasao: 0.675 },
                { nome: "Cecília Nascimento", curso: "Jornalismo", matricula: 203090174, probabilidade_evasao: 0.784 },
                { nome: "Gustavo Henrique Pinto", curso: "Enfermagem", matricula: 201764786, probabilidade_evasao: 0.779 },
                { nome: "Gustavo Castro", curso: "Engenharia Elétrica", matricula: 201369119, probabilidade_evasao: 0.241 },
                { nome: "Sra. Natália Martins", curso: "Ciência da Computação", matricula: 206271471, probabilidade_evasao: 0.057 },
                { nome: "João Souza", curso: "Artes Visuais", matricula: 204830280, probabilidade_evasao: 0.697 },
                { nome: "Davi Lucas Barbosa", curso: "Publicidade e Propaganda", matricula: 205828029, probabilidade_evasao: 0.142 },
                { nome: "Sr. Pedro Mendes", curso: "Ciência da Computação", matricula: 209421060, probabilidade_evasao: 0.095 },
                { nome: "Beatriz da Conceição", curso: "Filosofia", matricula: 209782647, probabilidade_evasao: 0.017 },
                { nome: "Luna Silva", curso: "Geografia", matricula: 206331771, probabilidade_evasao: 0.825 },
                { nome: "Helena Cardoso", curso: "Enfermagem", matricula: 206041259, probabilidade_evasao: 0.315 },
                { nome: "Olivia Castro", curso: "Economia", matricula: 205377512, probabilidade_evasao: 0.44 },
                { nome: "Gabrielly Lopes", curso: "Publicidade e Propaganda", matricula: 204772468, probabilidade_evasao: 0.398 },
                { nome: "Emilly da Rocha", curso: "Artes Visuais", matricula: 209356743, probabilidade_evasao: 0.043 },
                { nome: "Laura da Cunha", curso: "Química", matricula: 209066504, probabilidade_evasao: 0.524 },
                { nome: "João Miguel Teixeira", curso: "Filosofia", matricula: 202552545, probabilidade_evasao: 0.768 },
                { nome: "Yasmin Aragão", curso: "Ciência da Computação", matricula: 204015723, probabilidade_evasao: 0.197 },
                { nome: "Augusto das Neves", curso: "Engenharia Civil", matricula: 203979809, probabilidade_evasao: 0.008 },
                { nome: "Clarice Aragão", curso: "Letras", matricula: 209347198, probabilidade_evasao: 0.979 },
                { nome: "Kevin Pires", curso: "Jornalismo", matricula: 204154213, probabilidade_evasao: 0.397 },
                { nome: "Heloísa Rezende", curso: "Publicidade e Propaganda", matricula: 203676475, probabilidade_evasao: 0.0 },
                { nome: "Sr. Antônio Costa", curso: "História", matricula: 204167578, probabilidade_evasao: 0.093 },
                { nome: "Kevin Cardoso", curso: "Direito", matricula: 207490854, probabilidade_evasao: 0.245 },
                { nome: "Srta. Isabelly Ramos", curso: "Ciência da Computação", matricula: 201218748, probabilidade_evasao: 0.222 },
                { nome: "Sr. Bernardo Viana", curso: "Enfermagem", matricula: 206064062, probabilidade_evasao: 0.43 },
                { nome: "Agatha Rezende", curso: "Direito", matricula: 205207793, probabilidade_evasao: 0.483 },
                { nome: "Fernanda Araújo", curso: "Direito", matricula: 205783596, probabilidade_evasao: 0.628 },
                { nome: "Henrique Oliveira", curso: "Contabilidade", matricula: 203633711, probabilidade_evasao: 0.644 },
                { nome: "Ana Laura Ferreira", curso: "Direito", matricula: 203837711, probabilidade_evasao: 0.481 },
                { nome: "Beatriz Moreira", curso: "Economia", matricula: 201500479, probabilidade_evasao: 0.666 },
                { nome: "Nina Mendes", curso: "Educação Física", matricula: 207474389, probabilidade_evasao: 0.961 },
                { nome: "Isabella Pires", curso: "Filosofia", matricula: 203484984, probabilidade_evasao: 0.598 },
                { nome: "Maria Luiza Alves", curso: "Ciência da Computação", matricula: 203017379, probabilidade_evasao: 0.555 },
                { nome: "Kamilly Duarte", curso: "Economia", matricula: 207493276, probabilidade_evasao: 0.12 },
                { nome: "Luiza Castro", curso: "Ciência da Computação", matricula: 209795876, probabilidade_evasao: 0.366 },
                { nome: "Guilherme da Rosa", curso: "Arquitetura", matricula: 208424181, probabilidade_evasao: 0.364 },
                { nome: "Vitória Mendes", curso: "Direito", matricula: 201981958, probabilidade_evasao: 0.042 },
                { nome: "Carlos Eduardo da Costa", curso: "Jornalismo", matricula: 203516267, probabilidade_evasao: 0.404 },
                { nome: "Matheus Pinto", curso: "Design", matricula: 209142411, probabilidade_evasao: 0.404 },
                { nome: "Yago Campos", curso: "História", matricula: 208663740, probabilidade_evasao: 0.751 },
                { nome: "João Guilherme Costela", curso: "Administração", matricula: 205347221, probabilidade_evasao: 0.363 },
                { nome: "Luiz Miguel Barros", curso: "Enfermagem", matricula: 209180650, probabilidade_evasao: 0.383 },
                { nome: "Nicolas Vieira", curso: "Química", matricula: 203901058, probabilidade_evasao: 0.561 },
                { nome: "Vitor Hugo Monteiro", curso: "Jornalismo", matricula: 208546797, probabilidade_evasao: 0.565 },
                { nome: "João Felipe da Cruz", curso: "Medicina", matricula: 208450557, probabilidade_evasao: 0.207 },
                { nome: "Bruna Moura", curso: "Biologia", matricula: 205456119, probabilidade_evasao: 0.713 },
                { nome: "Sr. Fernando Dias", curso: "Sociologia", matricula: 201342121, probabilidade_evasao: 0.554 },
                { nome: "Pietro Alves", curso: "Psicologia", matricula: 202601645, probabilidade_evasao: 0.271 },
                { nome: "Murilo Costa", curso: "Enfermagem", matricula: 203532566, probabilidade_evasao: 0.915 },
                { nome: "Thales da Paz", curso: "Física", matricula: 200272564, probabilidade_evasao: 0.955 },
                { nome: "Pietro Ribeiro", curso: "Biologia", matricula: 208602003, probabilidade_evasao: 0.875 },
                { nome: "Vitor Hugo Moura", curso: "Enfermagem", matricula: 201309749, probabilidade_evasao: 0.556 },
                { nome: "Ana Carvalho", curso: "Publicidade e Propaganda", matricula: 206269986, probabilidade_evasao: 0.926 },
                { nome: "Maria Vitória da Luz", curso: "Artes Visuais", matricula: 200388779, probabilidade_evasao: 0.708 },
                { nome: "Davi Lucas Araújo", curso: "Biologia", matricula: 202889529, probabilidade_evasao: 0.351 }
            ];

            const codigosParaNomes = {
                ADM: "Administração",
                ARC: "Arquitetura",
                ART: "Artes Visuais",
                BIO: "Biologia",
                CCO: "Ciência da Computação",
                CON: "Contabilidade",
                DES: "Design",
                DIR: "Direito",
                EDF: "Educação Física",
                ECO: "Economia",
                ENF: "Enfermagem",
                ENGC: "Engenharia Civil",
                ENGE: "Engenharia Elétrica",
                FIL: "Filosofia",
                FIS: "Física",
                GEO: "Geografia",
                HIS: "História",
                JOR: "Jornalismo",
                LET: "Letras",
                MAT: "Matemática",
                MED: "Medicina",
                PUB: "Publicidade e Propaganda",
                PSI: "Psicologia",
                QUI: "Química",
                SOC: "Sociologia"
            };

            function getBarColor(evasao) {
                if (evasao > 0.7) return "bg-danger";
                if (evasao > 0.4) return "bg-warning";
                if (evasao > 0.2) return "bg-info";
                return "bg-success";
            }

            function getCodigoCurso() {
                const params = new URLSearchParams(window.location.search);
                return params.get('codigo');
            }

            const tbody = document.getElementById("tabela-cursos");
            const inputPesquisa = document.querySelector('.input-group input');
            const codigoCurso = getCodigoCurso();
            const nomeCurso = codigosParaNomes[codigoCurso];

            let alunosFiltrados = alunos.filter(aluno => aluno.curso === nomeCurso);
            let filtroAtual = 'evasao';
            let ordemCrescente = false;

            document.querySelector('.container h2')?.remove(); // Remove se já existir
            const titulo = document.createElement('h2');
            titulo.className = "mb-4";
            titulo.textContent = nomeCurso ? `Alunos do curso: ${nomeCurso}` : "Curso não encontrado";
            titulo.style.color = "#212529"; // Cor escura para melhor contraste
            titulo.style.backgroundColor = "#fff"; // Fundo branco para contraste
            titulo.style.padding = "0.5rem 1rem";
            titulo.style.borderRadius = "0.25rem";
            document.querySelector('.container').prepend(titulo);

            function renderTabela(lista) {
                tbody.innerHTML = '';
                lista.forEach(aluno => {
                    const row = document.createElement("tr");
                    row.style.cursor = "pointer";
                    row.addEventListener("click", () => {
                        window.location.href = `aluno.html?codigo=${encodeURIComponent(aluno.matricula)}`;
                    });
                    row.innerHTML = `
                        <td>${aluno.nome}</td>
                        <td>${aluno.matricula}</td>
                        <td>
                            <div class="progress">
                                <div class="progress-bar ${getBarColor(aluno.probabilidade_evasao)}" style="width: ${(aluno.probabilidade_evasao * 100).toFixed(1)}%; min-width: 60px;">
                                    ${(aluno.probabilidade_evasao * 100).toFixed(1).replace('.', ',')}%
                                </div>
                            </div>
                        </td>`;
                    tbody.appendChild(row);
                });
            }

            function filtrarTabela() {
                const termo = inputPesquisa.value.trim().toLowerCase();
                alunosFiltrados = alunos.filter(aluno =>
                    aluno.nome.toLowerCase().includes(termo) ||
                    String(aluno.matricula).includes(termo) ||
                    (aluno.probabilidade_evasao * 100).toFixed(1).replace('.', ',').includes(termo) ||
                    (aluno.probabilidade_evasao * 100).toFixed(1).includes(termo)
                );
                ordenarTabela();
            }

            function ordenarTabela() {
                alunosFiltrados.sort((a, b) => {
                    let valA, valB;
                    if (filtroAtual === 'nome') {
                        valA = a.nome.toLowerCase();
                        valB = b.nome.toLowerCase();
                        if (valA < valB) return ordemCrescente ? -1 : 1;
                        if (valA > valB) return ordemCrescente ? 1 : -1;
                        return 0;
                    } else if (filtroAtual === 'matricula') {
                        valA = a.matricula;
                        valB = b.matricula;
                        return ordemCrescente ? valA - valB : valB - valA;
                    } else if (filtroAtual === 'evasao') {
                        valA = a.probabilidade_evasao;
                        valB = b.probabilidade_evasao;
                        return ordemCrescente ? valA - valB : valB - valA;
                    }
                    return 0;
                });
                renderTabela(alunosFiltrados);
            }

            function setFiltro(filtro, crescente) {
                filtroAtual = filtro;
                ordemCrescente = crescente;
                const nomesFiltro = {
                    nome: "Nome",
                    matricula: "Matrícula",
                    evasao: "Evasão"
                };
                const ordem = ordemCrescente ? "↑" : "↓";
                document.getElementById('texto-filtro').textContent = `${nomesFiltro[filtro]} ${ordem}`;
                ordenarTabela();
            }

            // Eventos
            inputPesquisa.addEventListener('input', filtrarTabela);

            // Inicialização
            ordenarTabela();
        </script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
    </body>

</html>